<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="../css/General.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script type="text/javascript" src="../js/Scroll_arriba.js">
  </script>
  <script type="text/javascript" src="../js/Menu.js">
  </script>
  <script type="text/javascript" src="../js/auth_2.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js"></script>
  <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">
</head>
<body>

<!-- Cabecera -->
<div class="header">
  <a href="../index.html"><img src="../img/header.png" alt=""></a>
</div>

<!-- Simulate a smartphone / tablet -->
<div class="mobile-container">

  <!-- Top Navigation Menu -->
  <div class="topnav">
    <div>
      <a href="../index.html" class="active"><img src="../img/header_smartphone.png" alt="">
      <a href="../index.html" class="active"><img src="../img/header_smartphone.png" alt="Portada" class="topnav_smartphone"></a>

    </div>
    <div id="myLinks">
      <a href="../index.html">Inicio</a>
      <a href="../html/Noticias.html">Noticias</a>
      <a href="../html/Clasificacion.html">Clasficación</a>
      <a href="../html/Equipos.html">Equipos</a>
      <a>

      </a>
      <a id="idnuevo" style="float:right"></a>
      <a href="../html/IniciarSesion.html" style="float:right" id="id_iniciar_sesion">Iniciar sesión</a>
      <a style="float:right" id="id_div_logout"><button id="id_logout"></button></a>
      <a href="../html/IniciarSesion.html" style="float:right">Iniciar sesión</a>
    </div>
    <div class="burger_icon">
      <a href="javascript:void(0);" class="icon" onclick="BurguerMenu()">
        <i class="fa fa-bars"></i>
      </a>
    </div>
  </div>

  <!-- Columnas -->
  <div class="row">
    <div class="leftcolumn">
      <div class="card" id="id_noticia_completa">
        <h1><div id="id_titulo_noticia"></div>
        </h1>
        <h2>
          <div id="id_subtitulo_noticia">
          </div>
        </h2>
        <div class="youtube-video-container">
          <iframe width="560" height="315" src="https://www.youtube.com/embed/Oiw8XY5ovf0" title="YouTube video player"
      <div class="card">
        <h1>Posible alineación del Real Madrid contra el Sheriff en Champions League</h1>
        <h2>
          Los regresos de Lucas Vázquez y de Hazard a la titularidad, el cambio de posición de Valverde, que regresa al
          centro del campo, y la convocatoria de Kroos, las grandes novedades.
        </h2>
        <div class="youtube-video-container">
          <iframe width="560" height="315" src="https://www.youtube.com/embed/A1IUobtjPHo" title="YouTube video player"
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen></iframe>
        </div>

        <p>
        <div id="id_parte1_noticia">
        </div>
        </p>
        <p>
          El estadio Santiago Bernabéu vuelve a acoger un partido de Champions 580 días después. Fue Kevin de Bruyne, de
          penalti, quien marcó el último gol al transformar un penalti de Sergio Ramos sobre Gabriel Jesús en febrero de
          2020. Días después, el estallido de la pandemia del Coronavirus frenó todo tipo de competición. Sería en
          agosto
          de ese año cuando se retomaría la fase final del torneo. Allí, en Manchester, quedaría eliminado el conjunto
          blanco a principios del octavo mes del año. La siguiente campaña, los blancos jugarían seis encuentros de la
          competición europea en el Alfredo Di Stéfano de Valdebebas. Las obras en el Bernabéu impedían cualquier tipo
          de
          encuentro deportivo.
        </p>
        <div class="imagen_notica_grande">
          <img src="../img/noticias/Noticia2_Grande.jpg">
          <br>
          <i>Posible alineación del Real Madrid</i>
        </div>

        <p>
        <div id="id_parte2_noticia">
        </div>
        </p>


        <div class="like_dislike" id="id_likes_dislikes">
          <form>¿Te ha gustado la noticia? </form>
          <input type="image" src="../img/noticias/like.png" alt="Boton like" id="id_like"><input
          type="image" src="../img/noticias/dislike.png" alt="Boton dislike" id="id_dislike">
        </div>

        <label for="id_zona_comentarios">Comentario:</label>
        <div id="id_zona_comentarios"></div>
        <br><br>
        <div id="id_zona_comentario_usuario_cookie"><input type="submit" value="Subir comentario"
                                                           id="id_boton_comentar">
          <input type="text" name="correo" id="id_zona_comentarios_texto"></div>

          Para este encuentro en el coliseo blanco, las novedades son la presencia de Carlo Ancelotti, un entrenador que
          durante las dos temporadas que estuvo mediada la década pasada ganó 10 de los 12 encuentros que jugó el Madrid
          en Champions como local en el Bernabéu (perdió un encuentro, ante el Schalke, 3-4, y empató otro, ante la
          Juventus, 1-1, en el que sería su último encuentro europeo con el conjunto blanco en 2015), y la otra es la
          presencia en la convocatoria de Toni Kroos. El centrocampista alemán regresa tras superar sus problemas de
          pubalgia después de estar casi cuatro meses fuera de la disciplina blanca: su último partido fue el 9 de mayo
          en
          un encuentro ante el Sevilla en el Di Stéfano. Posteriormente jugaría la Eurocopa con Alemania.
        </p>

        <div class="like_dislike">
          <form>¿Te ha gustado la noticia? <input type="image" src="../img/noticias/like.png" alt="Boton like"><input
            type="image" src="../img/noticias/dislike.png" alt="Boton dislike"></form>
        </div>
      </div>

    </div>
    <div class="rightcolumn">
      <div class="encuesta">
        <form alt="Encuesta">
          <h3><div id="id_titulo_encuesta"></div></h3>
          <input type="button" id="id_opcion1" name="equipo_ganador">
          <label for="id_opcion1"></label><br>
          <input type="button" id="id_opcion2" name="equipo_ganador">
          <label for="id_opcion2"></label><br>
          <br>
          <h3>¿Quién ganará mañana?</h3>
          <input type="radio" id="id_real_madrid" name="equipo_ganador" value="RealMadrid">
          <label for="id_real_madrid">Real Madrid</label><br>
          <input type="radio" id="id_barcelona" name="equipo_ganador" value="Barcelona">
          <label for="id_barcelona">Barcelona</label><br>
          <br>
          <input type="submit" value="Votar">
        </form>
      </div>
    </div>
  </div>

  <!-- Pie de página -->
  <div class="footer">
    <hr>
    <a href="https://www.facebook.com/superliga" target="_self" class="footer_icon"><img src="../img/icon_facebook.png"                                                                       alt="Facebook"
                                                                                         style="width:50px;height:535;"></a>
    <a href="https://www.instagram.com/superliga" target="_self"><img src="../img/icon_instagram.png" alt="Instagram"
                                                                      style="width:50px;height:535;"></a>
    <a href="https://www.youtube.com/superliga" target="_self"><img src="../img/icon_youtube.png" alt="YouTube"
                                                                    style="width:50px;height:535;"></a>
  </div>

</div>

<div class="scroll_up">
  <img src="../img/Up_icon.png" alt="Boton_arriba" class="boton_arriba"
       onclick="topFunction()">
</div>
</script>
<script src="../js/auth_2.js"></script>

<script type="module">
  console.log("Estoy en el script 2 del html de Noticias");
  // Import the functions you need from the SDKs you need
  import {initializeApp} from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";

  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  const firebaseConfig = {
    ---
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);

  import {getDatabase, ref, set, get, child, update, remove}
    from "https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js";

  const db = getDatabase();

  // -------------- References ----------------- //
  // var namebox = document.getElementById("Namebox");
  //  var rollbox = document.getElementById("Rollbox");
  // var secbox = document.getElementById("Secbox");
  // var genbox = document.getElementById("Genbox");
  var cmtbox = document.getElementById("id_zona_comentarios_texto");
  var zncmtbox = document.getElementById("id_zona_comentarios_texto");

  // var insBtn = document.getElementById("Insbtn");
  var cmtBtn = document.getElementById("id_boton_comentar");
  var logoutBtn = document.getElementById("id_logout");

  var likeBtn = document.getElementById("id_like");
  var dislikeBtn = document.getElementById("id_dislike");
  //var selBtn = document.getElementById("Selbtn");
  // var updBtn = document.getElementById("Updbtn");
  // var delBtn = document.getElementById("Delbtn");

  var opcion1Btn = document.getElementById("id_opcion1");
  var opcion2Btn = document.getElementById("id_opcion2");

  // ------------- INSERT DATA FUNCTION ------------- //

  function CrearUsuario() {

    const dbref = ref(db);

    var myStr = leerCookie("user_mail");
    var newStr = myStr.split('.').join("");
    console.log(newStr)

    update(ref(db, "Usuarios/" + newStr), {
      NameOfStd: "namebox.value",
      RollNo: "rollbox.value",
      Section: "secbox.value",
      Gender: "genbox.value"
    })
      .then(() => {
        // alert("data updated succesfully!")
      })
      .catch((error) => {
        //  alert("unsuccessful, error" + error);
      });

  }

  function Comentar() {
    var myStr = leerCookie("user_mail");
    var newStr = myStr.split('.').join("");

    if (newStr != null || newStr != "") {
      const dbref = ref(db);

      get(child(dbref, "Noticias/Noticia 2/Comentarios/" + newStr)).then((snapshot) => {
        if (snapshot.exists()) {
          alert("Ya ha comentado antes en esta noticia.");

        } else {
          set(ref(db, "Noticias/Noticia 2/Comentarios/" + newStr), {
            Comentario: cmtbox.value
          })
            .then(() => {
              alert("data store succesfully!")
            })
            .catch((error) => {
              alert("COMENTAR unsuccessful, error" + error);
            });
        }
      })
        .catch((error) => {
          alert("Unseccessful, error" + error)
        })
    }

    console.log("Final del método de comentar");


  }

  function InsertData() {

    const dbref = ref(db);

    get(child(dbref, "Usuarios/" + rollbox.value)).then((snapshot) => {
      if (snapshot.exists()) {
        alert("El usuario con ese nombre ya existe.");

      } else {
        set(ref(db, "Usuarios/" + rollbox.value), {
          NameOfStd: namebox.value,
          RollNo: rollbox.value,
          Section: secbox.value,
          Gender: genbox.value
        })
          .then(() => {
            alert("data store succesfully!")
          })
          .catch((error) => {
            alert("unsuccessful, error" + error);
          });
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })

  }

  // ------------- SELECT DATA FUNCTION ------------- //

  function SelectData() {
    const dbref = ref(db);

    get(child(dbref, "Usuarios/" + rollbox.value)).then((snapshot) => {
      if (snapshot.exists()) {
        namebox.value = snapshot.val().NameOfStd;
        secbox.value = snapshot.val().Section;
        genbox.value = snapshot.val().Gender;
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })
  }





  function CargarNoticia() {
    const dbref = ref(db);

    // TITULO
    get(child(dbref, "Noticias/Noticia 2/Titulo/")).then((snapshot) => {
      if (snapshot.exists()) {
        document.getElementById("id_titulo_noticia").innerHTML = snapshot.val();
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })

    // SUBTITULO
    get(child(dbref, "Noticias/Noticia 2/Subtitulo/")).then((snapshot) => {
      if (snapshot.exists()) {
        document.getElementById("id_subtitulo_noticia").innerHTML = snapshot.val();
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })

    // PARTE 1

    get(child(dbref, "Noticias/Noticia 2/Parte 1/")).then((snapshot) => {
      if (snapshot.exists()) {
        document.getElementById("id_parte1_noticia").innerHTML = snapshot.val();
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })

    // PARTE 2
    get(child(dbref, "Noticias/Noticia 2/Parte 2/")).then((snapshot) => {
      if (snapshot.exists()) {
        document.getElementById("id_parte2_noticia").innerHTML = snapshot.val();
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })
  }

  function CrearCajasComentarios(usuario) {
    const dbref = ref(db);

    var myStr = usuario;
    var newStr = myStr.split('.').join("");

    console.log("ESTOY DENTRO DE CrearCajasComentarios");

    get(child(dbref, "Noticias/Noticia 2/Comentarios/" + newStr)).then((snapshot) => {
      if (snapshot.exists()) {

        snapshot.forEach((questionSnapshot) => {
          document.getElementById("id_zona_comentarios").innerHTML += "Usuario: " + newStr + " | Comentario:  " + snapshot.val().Comentario + "<br>";
        });

      } else {
        // alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })
  }

  function ObtenerUsuarios() {
    const dbref = ref(db);

    get(child(dbref, "Usuarios/")).then((snapshot) => {
      if (snapshot.exists()) {

        snapshot.forEach((questionSnapshot) => {
          //document.getElementById("id_zona_comentarios").innerHTML += questionSnapshot.key + "<br>";
          CrearCajasComentarios(questionSnapshot.key);
          console.log(questionSnapshot.key);
        });

      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })
  }


  // ------------- UPDATE DATA FUNCTION ------------- //

  function UpdateData() {
    update(ref(db, "Usuarios/" + rollbox.value), {
      NameOfStd: namebox.value,
      RollNo: rollbox.value,
      Section: secbox.value,
      Gender: genbox.value
    })
      .then(() => {
        alert("data updated succesfully!")
      })
      .catch((error) => {
        alert("unsuccessful, error" + error);
      });
  }

  // ------------- REMOVE DATA FUNCTION ------------- //

  function RemoveData() {
    remove(ref(db, "Usuarios/" + rollbox.value))
      .then(() => {
        alert("data removed successfully");
      })
      .catch((error) => {
        alert("unsuccessfully, error" + error);
      });
  }

  function leerCookie(key) {
    var name = key + "=";
    var ca = document.cookie.split(';');
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i].trim();
      if ((c.indexOf(name)) == 0) {
        hay_usuario = true;
        return c.substr(name.length);
      }
    }
    return null;
  }

  function subir_like(){
    const dbref = ref(db);

    get(child(dbref, "Noticias/Noticia 2/Likes")).then((snapshot) => {
      if (snapshot.exists()) {
        // Principio update
        var cantidad_likes = snapshot.val()

        cantidad_likes += 1;
        alert("Gracias por dar like. Likes actuales: " + cantidad_likes);

        update(ref(db, "Noticias/Noticia 2/"), {
          Likes: cantidad_likes
        })
          .then(() => {
            //alert("data updated succesfully!")
          })
          .catch((error) => {
            alert("unsuccessful, error" + error);
          });
        // Fin update
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })
  }

  function subir_dislike(){
    const dbref = ref(db);

    get(child(dbref, "Noticias/Noticia 2/Dislikes")).then((snapshot) => {
      if (snapshot.exists()) {
        // Principio update
        var cantidad_likes = snapshot.val()

        cantidad_likes += 1;
        alert("Sentimos que no te haya gustado. Cantidad de dislikes: " + cantidad_likes);

        update(ref(db, "Noticias/Noticia 2/"), {
          Dislikes: cantidad_likes
        })
          .then(() => {
            //alert("data updated succesfully!")
          })
          .catch((error) => {
            alert("unsuccessful, error" + error);
          });
        // Fin update
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })
  }

  function CargarEncuesta() {
    const dbref = ref(db);

    // Pregunta
    get(child(dbref, "Encuesta/Pregunta")).then((snapshot) => {
      if (snapshot.exists()) {
        document.getElementById("id_titulo_encuesta").innerHTML = snapshot.val();
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })

    // Respuesta1
    get(child(dbref, "Encuesta/Respuesta1")).then((snapshot) => {
      if (snapshot.exists()) {
        document.getElementById("id_opcion1").value = snapshot.val();
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })

    // Respuesta2
    get(child(dbref, "Encuesta/Respuesta2")).then((snapshot) => {
      if (snapshot.exists()) {
        document.getElementById("id_opcion2").value = snapshot.val();
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })


  }


  function logout_cookie() {
    eliminarCookie("user_mail");
    eliminarCookie("user_pass");
    history.go(0);
  }

  function subir_opcion1(){
    const dbref = ref(db);

    get(child(dbref, "Encuesta/Opcion1")).then((snapshot) => {
      if (snapshot.exists()) {
        // Principio update
        var cantidad_votos = snapshot.val()
        alert("Se ha enviado la votación");

        cantidad_votos += 1;
        update(ref(db, "Encuesta/"), {
          Opcion1: cantidad_votos
        })
          .then(() => {
            //alert("data updated succesfully!")
          })
          .catch((error) => {
            alert("unsuccessful, error" + error);
          });
        // Fin update
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })
  }

  function subir_opcion2(){
    const dbref = ref(db);

    get(child(dbref, "Encuesta/Opcion2")).then((snapshot) => {
      if (snapshot.exists()) {
        // Principio update
        var cantidad_votos = snapshot.val()
        alert("Se ha enviado la votación");

        cantidad_votos += 1;
        update(ref(db, "Encuesta/"), {
          Opcion2: cantidad_votos
        })
          .then(() => {
            //alert("data updated succesfully!")
          })
          .catch((error) => {
            alert("unsuccessful, error" + error);
          });
        // Fin update
      } else {
        alert("No data found");
      }
    })
      .catch((error) => {
        alert("Unseccessful, error" + error)
      })
  }


  var usuario_cookie = leerCookie("user_mail");
  if (usuario_cookie == null) {
    document.getElementById("id_zona_comentario_usuario_cookie").style.display = "none";
    document.getElementById("id_likes_dislikes").style.display = "none";
    document.getElementById("id_noticia_completa").innerHTML = "<h1>Contenido solo para usuarios registrados</h1>";
  } else {
    document.getElementById("id_iniciar_sesion").style.display = "none";

    document.getElementById("idnuevo").innerHTML =
      "Bienvenido, " + usuario_cookie;
    document.getElementById("id_logout").innerHTML =
      "LOG OUT";
    CrearUsuario();
    CargarNoticia();
    ObtenerUsuarios();

  }
  CargarEncuesta()
  //document.getElementById("id_zona_comentarios").innerHTML += "holaaaa";
  // Comentar();


  // ------------- Assign events to btns ------------- //
  // insBtn.addEventListener('click', InsertData);
  //selBtn.addEventListener('click', SelectData);
  //updBtn.addEventListener('click', UpdateData);
  //delBtn.addEventListener('click', RemoveData);

  cmtBtn.addEventListener('click', Comentar);
  likeBtn.addEventListener('click', subir_like);
  dislikeBtn.addEventListener('click', subir_dislike);
  logoutBtn.addEventListener('click', logout_cookie);
  opcion1Btn.addEventListener('click', subir_opcion1);
  opcion2Btn.addEventListener('click', subir_opcion2);

</script>


</body>
</html>
